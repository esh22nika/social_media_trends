<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>TrendMiner</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="/css/global.css" />
  <style>
    body, html { margin:0; padding:0; font-family: 'Inter', sans-serif; overflow:hidden; }
    #background { position:absolute; top:0; left:0; width:100%; height:100%; z-index:-1; }
    .tm-landing { position:relative; display:flex; justify-content:center; align-items:center; height:100vh; flex-direction:column; text-align:center; z-index:1; }
    canvas { display:block; }
  </style>
</head>
<body>
  <div id="background"></div>

  <header class="tm-header">
    <div class="tm-brand" onclick="window.location.href='/'">
      <img src="/icons/trend.svg" alt="TrendMiner" class="tm-logo"/>
      <span>TrendMiner</span>
    </div>
    <nav class="tm-nav">
      <a href="/overview.html">Overview</a>
      <a href="/discover.html">Discover</a>
      <a href="/network.html">Network</a>
      <a href="/timeline.html">Timeline</a>
      <a href="/insights.html">Insights</a>
    </nav>
  </header>

  <main class="tm-landing">
    <div class="tm-hero">
      <h1>TrendMiner</h1>
      <p>Analyze social trends and emerging patterns across platforms.</p>
      <button class="tm-button" onclick="window.location.href='/overview.html'">Get Started</button>
    </div>
  </main>

  <footer class="tm-footer">Â© <span id="tm-year"></span> TrendMiner</footer>

  <script src="https://d3js.org/d3.v3.min.js"></script>
  <script>
    document.getElementById('tm-year').textContent = new Date().getFullYear();

    var width = d3.select("#background").node().clientWidth,
        height = d3.select("#background").node().clientHeight;

    var num = 100, // number of nodes
        base = 10,  // node radius base
        dif = 20;   // radius variation

    // Public flat social media SVG URLs
    var icons = [
      'https://cdn.jsdelivr.net/npm/simple-icons@v9/icons/facebook.svg',
      'https://cdn.jsdelivr.net/npm/simple-icons@v9/icons/twitter.svg',
      'https://cdn.jsdelivr.net/npm/simple-icons@v9/icons/instagram.svg',
      'https://cdn.jsdelivr.net/npm/simple-icons@v9/icons/heart.svg',
      'https://cdn.jsdelivr.net/npm/simple-icons@v9/icons/comment.svg'
    ];

    var nodes = d3.range(num).map(function() { 
      return {radius: Math.random() * dif + base, icon: icons[Math.floor(Math.random() * icons.length)] }; 
    });

    var root = nodes[0];
    root.radius = 0;
    root.fixed = true;
    root.px = width/2;
    root.py = height/2;

    var force = d3.layout.force()
      .gravity(0.015)
      .charge(function(d, i) { return i ? 0 : - (height + width); })
      .nodes(nodes)
      .size([width, height]);

    force.start();

    var canvas = d3.select("#background").append("canvas")
      .attr("width", width)
      .attr("height", height);

    var context = canvas.node().getContext("2d");

    var iconImages = {};
    icons.forEach(function(src){
      var img = new Image();
      img.src = src;
      iconImages[src] = img;
    });

    var colors = ['#009cde', '#46c8b2', '#f5d800', '#ff8b22', '#ff6859', '#fc4d77'];

    force.on("tick", function() {
      var q = d3.geom.quadtree(nodes), i, d, n = nodes.length;

      for (i = 1; i < n; ++i) q.visit(collide(nodes[i]));

      context.clearRect(0, 0, width, height);
      force.size([width, height]);

      for (i = 1; i < n; ++i) {
        d = nodes[i];

        // Draw colorful circle
        context.fillStyle = colors[i % colors.length];
        context.globalAlpha = 0.6;
        context.beginPath();
        context.arc(d.x, d.y, d.radius, 0, 2 * Math.PI);
        context.fill();

        // Draw icon on top
        var img = iconImages[d.icon];
        if(img.complete){
          context.globalAlpha = 1.0;
          context.drawImage(img, d.x - d.radius, d.y - d.radius, d.radius*2, d.radius*2);
        }
      }
    });

    canvas.on("mousemove", move);
    canvas.on("touchmove", move);

    function move() {
      var p1 = d3.mouse(this);
      root.px = p1[0];
      root.py = p1[1];
      force.resume();
    }

    function collide(node) {
      var r = node.radius + 16,
          nx1 = node.x - r, nx2 = node.x + r,
          ny1 = node.y - r, ny2 = node.y + r;
      return function(quad, x1, y1, x2, y2) {
        if (quad.point && (quad.point !== node)) {
          var x = node.x - quad.point.x,
              y = node.y - quad.point.y,
              l = Math.sqrt(x * x + y * y),
              r = node.radius + quad.point.radius + 7;
          if (l < r) {
            l = (l - r) / l * 0.5;
            node.x -= x *= l;
            node.y -= y *= l;
            quad.point.x += x;
            quad.point.y += y;
          }
        }
        return x1 > nx2 || x2 < nx1 || y1 > ny2 || y2 < ny1;
      };
    }

    window.addEventListener('resize', function(){
      width = d3.select("#background").node().clientWidth;
      height = d3.select("#background").node().clientHeight;
      canvas.attr("width", width).attr("height", height);
      force.size([width, height]).resume();
    });

    // Swipe down to second page
    window.addEventListener('load', function(){
      var touchsurface = document.getElementById("background"),
          startX, startY, dist, threshold = 150,
          allowedTime = 200, elapsedTime, startTime;

      function handleswipe(down){ if(down) window.location.href = "#secondPage"; }

      touchsurface.addEventListener('touchstart', function(e){
        var touchobj = e.changedTouches[0];
        dist = 0; startX = touchobj.pageX; startY = touchobj.pageY;
        startTime = new Date().getTime();
      });

      touchsurface.addEventListener('touchend', function(e){
        var touchobj = e.changedTouches[0];
        dist = startY - touchobj.pageY;
        elapsedTime = new Date().getTime() - startTime;
        var down = (elapsedTime <= allowedTime && dist >= threshold && Math.abs(touchobj.pageX - startX) <= 100);
        handleswipe(down);
      });
    });
  </script>
</body>
</html>
